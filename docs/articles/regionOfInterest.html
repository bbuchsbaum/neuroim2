<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Regions of Interest • neuroim2</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Regions of Interest">
<meta property="og:description" content="neuroim2">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">neuroim2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ImageVolumes.html">Working with Image Volumes</a>
    </li>
    <li>
      <a href="../articles/NeuroVector.html">Four dimensional neuroimaging data</a>
    </li>
    <li>
      <a href="../articles/neuroim.html">The neuroim2 package</a>
    </li>
    <li>
      <a href="../articles/pipelines.html">Pipelines</a>
    </li>
    <li>
      <a href="../articles/regionOfInterest.html">Regions of Interest</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bbuchsbaum/neuroim2/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Regions of Interest</h1>
            
            <h4 data-toc-skip class="date">2022-10-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bbuchsbaum/neuroim2/blob/HEAD/vignettes/regionOfInterest.Rmd" class="external-link"><code>vignettes/regionOfInterest.Rmd</code></a></small>
      <div class="hidden name"><code>regionOfInterest.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="regions-of-interest">Regions of interest<a class="anchor" aria-label="anchor" href="#regions-of-interest"></a>
</h2>
<div class="section level3">
<h3 id="creating-a-spherical-roi">Creating a spherical ROI<a class="anchor" aria-label="anchor" href="#creating-a-spherical-roi"></a>
</h3>
<p>In <strong>neuroim2</strong> there is basic support for creating
regions of interest (ROI). To create a spherical ROI around a central
point, we need an existing object of type <code>NeuroVol</code> or
<code>NeuroSpace</code>.</p>
<p>To create a spherical region of interest with a 5mm radius around a
central voxel at i=20, j=20, k=20, we first read in an image.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>      <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bbuchsbaum/neuroim2" class="external-link">neuroim2</a></span><span class="op">)</span>        </span>
<span>      <span class="va">file_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"global_mask.nii"</span>, package<span class="op">=</span><span class="st">"neuroim2"</span><span class="op">)</span></span>
<span>      <span class="va">vol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_vol.html">read_vol</a></span><span class="op">(</span><span class="va">file_name</span><span class="op">)</span></span></code></pre></div>
<p>Next, we create a spherical ROI centered around voxel coordinates
[20,20,20] with a 5mm radius, filling all values in the ROI with
100.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>      <span class="va">sphere</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spherical_roi.html">spherical_roi</a></span><span class="op">(</span><span class="va">vol</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">20</span>,<span class="fl">20</span><span class="op">)</span>, radius<span class="op">=</span><span class="fl">5</span>, fill<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ROIVol </span></span>
<span><span class="co">#&gt;   Size:            11 </span></span>
<span><span class="co">#&gt;   Parent Dim:      64 64 25 </span></span>
<span><span class="co">#&gt;   Num Data Cols:   1 </span></span>
<span><span class="co">#&gt;   Voxel Cen. Mass: 20 20.27273 20</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="creating-a-spherical-roi-around-a-real-valued-coordinate">Creating a Spherical ROI around a real-valued coordinate<a class="anchor" aria-label="anchor" href="#creating-a-spherical-roi-around-a-real-valued-coordinate"></a>
</h3>
<p>To create a spherical ROI centered around a real coordinate in
millimeters, we need to first convert the real-valued coordinates to a
voxel-based coordinate. Suppose our real-world coordinate is at -50,
-28, 10 in coordinate space.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span>    <span class="va">rpoint</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">34</span>,<span class="op">-</span><span class="fl">28</span>,<span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p>Because the function <code>spherical_roi</code> takes a coordinate in
<em>voxel units</em>, we need to convert the real-world coordinate
(i.e. in millimeter units) to voxel coordinates.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>    </span>
<span>    <span class="va">vox</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/coord_to_grid-methods.html">coord_to_grid</a></span><span class="op">(</span><span class="va">vol</span>, <span class="va">rpoint</span><span class="op">)</span></span>
<span>    <span class="va">sphere</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spherical_roi.html">spherical_roi</a></span><span class="op">(</span><span class="va">vol</span>, <span class="va">vox</span>, radius<span class="op">=</span><span class="fl">10</span>, fill<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="fu"><a href="../reference/coords-methods.html">coords</a></span><span class="op">(</span><span class="va">sphere</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 85  3</span></span></code></pre></div>
<p>Now we convert back to real-world coordinates</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>    <span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/index_to_coord-methods.html">index_to_coord</a></span><span class="op">(</span><span class="va">vol</span>, <span class="fu"><a href="../reference/indices-methods.html">indices</a></span><span class="op">(</span><span class="va">sphere</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">center_of_mass</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">coords</span><span class="op">)</span></span>
<span>    <span class="va">center_of_mass</span></span>
<span><span class="co">#&gt; [1] -33.25 -29.25  11.15</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="converting-an-roi-to-a-sparseneurovol">Converting an ROI to a SparseNeuroVol<a class="anchor" aria-label="anchor" href="#converting-an-roi-to-a-sparseneurovol"></a>
</h3>
<p>We may want to convert a region of interest to a NeuroVol instance.
But we don’t want to store every value in a dense array. Here we can
make use of the <code>SparseNeuroVol</code> class which only stores
non-zero values my using a <code><a href="https://rdrr.io/pkg/Matrix/man/sparseVector.html" class="external-link">Matrix::sparseVector</a></code> under the
hood.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>    </span>
<span>    <span class="va">sphere</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spherical_roi.html">spherical_roi</a></span><span class="op">(</span><span class="va">vol</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>,<span class="fl">10</span>,<span class="fl">10</span><span class="op">)</span>, radius<span class="op">=</span><span class="fl">10</span>, fill<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">sphere</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ROIVol </span></span>
<span><span class="co">#&gt;   Size:            85 </span></span>
<span><span class="co">#&gt;   Parent Dim:      64 64 25 </span></span>
<span><span class="co">#&gt;   Num Data Cols:   1 </span></span>
<span><span class="co">#&gt;   Voxel Cen. Mass: 50 10 10</span></span></code></pre></div>
<p>Now we construct a <code>SparseNeuroVol</code> and fill it with the
values stored in the ROI:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>    <span class="va">sparsevol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SparseNeuroVol-class.html">SparseNeuroVol</a></span><span class="op">(</span><span class="va">sphere</span>, <span class="fu"><a href="../reference/space-methods.html">space</a></span><span class="op">(</span><span class="va">vol</span><span class="op">)</span>,indices<span class="op">=</span><span class="fu"><a href="../reference/indices-methods.html">indices</a></span><span class="op">(</span><span class="va">sphere</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sparsevol</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sphere</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">sparsevol</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">vol</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="carrying-out-simple-searchlight-roi-analyses">Carrying out simple “searchlight” ROI analyses<a class="anchor" aria-label="anchor" href="#carrying-out-simple-searchlight-roi-analyses"></a>
</h3>
<p>The so-called roving “searchlight” is often used to perform
multivariate statistical analyses in a local neighborhood of each voxel
of an image. Several functions in <code>neuroim2</code> can be used to
carry out searchlight analyses. These functions produces
<code>list</code>s of the <code>ROIVol</code> instances that encapsulate
the local neighborhood around each voxel.</p>
<p>Here, we compute the mean value in an exhaustive set of spherical
searchlights in an image volume.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">## generate a list of searchlight ROIs</span></span>
<span><span class="va">slist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/searchlight.html">searchlight</a></span><span class="op">(</span><span class="va">vol</span>, eager<span class="op">=</span><span class="cn">TRUE</span>, radius<span class="op">=</span><span class="fl">8</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## compute the mean value in each searchlight ROI.</span></span>
<span><span class="va">ret</span> <span class="op">&lt;-</span> <span class="va">slist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">vol</span><span class="op">[</span><span class="fu"><a href="../reference/coords-methods.html">coords</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can also use a “randomized searchlight”, which samples voxels
without replacement until all voxels have been included in at least one
searchlight.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ret</span> <span class="op">&lt;-</span> <span class="va">vol</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/random_searchlight.html">random_searchlight</a></span><span class="op">(</span>radius<span class="op">=</span><span class="fl">8</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">vol</span><span class="op">[</span><span class="fu"><a href="../reference/coords-methods.html">coords</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Another related method involves using a “parcellation” or clustering
to define successive regions of interest for an analysis. Here we show
how to do this in a similar way as above. First we must define a
‘clustering’ over the voxel space:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/index_to_coord-methods.html">index_to_coord</a></span><span class="op">(</span><span class="va">vol</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">vol</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">kres</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html" class="external-link">kmeans</a></span><span class="op">(</span><span class="va">grid</span>, centers<span class="op">=</span><span class="fl">50</span>, iter.max<span class="op">=</span><span class="fl">500</span><span class="op">)</span></span></code></pre></div>
<p>Now we create a <code>ClusteredNeuroVol</code> and map the
<code>mean</code> function over all clusters:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kvol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ClusteredNeuroVol-class.html">ClusteredNeuroVol</a></span><span class="op">(</span><span class="va">vol</span>, <span class="va">kres</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span></span>
<span><span class="va">ret</span> <span class="op">&lt;-</span> <span class="va">vol</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/searchlight.html">clustered_searchlight</a></span><span class="op">(</span>cvol<span class="op">=</span><span class="va">kvol</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">vol</span><span class="op">[</span><span class="fu"><a href="../reference/coords-methods.html">coords</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="working-with-image-patches">Working with image patches<a class="anchor" aria-label="anchor" href="#working-with-image-patches"></a>
</h3>
<p>Another type of ROI analysis, similar to the ‘searchlight’, involves
working with sets of square or cuboid image “patches”. The
<code>patch_set</code> function can be used to generate a set of
equally-sized patches that span the image space (or some mask covering
the space). The patches are guaranteed to be of equal size. This means
that at edges, ‘patches’ will be padded out with the value at the image
extremes.</p>
<p>Here we create a patch set consistting of 3 by 3 by 1 square patches
that span the image.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">pset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/patch_set-methods.html">patch_set</a></span><span class="op">(</span><span class="va">vol</span>, dims<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pset</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 102400</span></span>
<span><span class="va">ret</span> <span class="op">&lt;-</span> <span class="va">pset</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now we limit patches so that the set of patch centers are within a
mask.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">pset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/patch_set-methods.html">patch_set</a></span><span class="op">(</span><span class="va">vol</span>, dims<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span>, mask<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">as.logical</a></span><span class="op">(</span><span class="va">vol</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pset</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 29532</span></span>
<span><span class="va">ret</span> <span class="op">&lt;-</span> <span class="va">pset</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Bradley R Buchsbaum.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
