<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />


<meta name="date" content="2025-08-31" />

<title>Regions of Interest</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Regions of Interest</h1>
<h4 class="date">2025-08-31</h4>



<pre><code>## Warning: package &#39;assertthat&#39; was built under R version 4.3.3</code></pre>
<pre><code>## Warning: package &#39;purrr&#39; was built under R version 4.3.3</code></pre>
<div id="introduction-to-regions-of-interest" class="section level1">
<h1>Introduction to Regions of Interest</h1>
<div id="what-are-rois" class="section level2">
<h2>What are ROIs?</h2>
<p>Regions of Interest (ROIs) are fundamental tools in neuroimaging
analysis that allow researchers to focus on specific brain areas or
patterns. Rather than analyzing every voxel in the brain independently,
ROIs enable:</p>
<ul>
<li><strong>Targeted analysis</strong> of anatomically or functionally
defined brain regions</li>
<li><strong>Dimensionality reduction</strong> by aggregating signals
within regions</li>
<li><strong>Statistical power</strong> improvement through spatial
averaging</li>
<li><strong>Hypothesis-driven</strong> investigations of specific brain
areas</li>
</ul>
</div>
<div id="roi-types-in-neuroim2" class="section level2">
<h2>ROI Types in neuroim2</h2>
<p>The <strong>neuroim2</strong> package provides comprehensive support
for creating and manipulating ROIs:</p>
<table>
<colgroup>
<col width="23%" />
<col width="23%" />
<col width="30%" />
<col width="23%" />
</colgroup>
<thead>
<tr class="header">
<th>ROI Type</th>
<th>Function</th>
<th>Description</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Spherical</strong></td>
<td><code>spherical_roi()</code></td>
<td>Sphere around a center point</td>
<td>Searchlight analysis, seed-based connectivity</td>
</tr>
<tr class="even">
<td><strong>Cuboid</strong></td>
<td><code>cuboid_roi()</code></td>
<td>Rectangular box region</td>
<td>Grid-based parcellation</td>
</tr>
<tr class="odd">
<td><strong>Square</strong></td>
<td><code>square_roi()</code></td>
<td>2D square in one plane</td>
<td>Slice-based analysis</td>
</tr>
<tr class="even">
<td><strong>Clustered</strong></td>
<td><code>ClusteredNeuroVol</code></td>
<td>Parcellation-based regions</td>
<td>Atlas-based analysis</td>
</tr>
<tr class="odd">
<td><strong>Custom</strong></td>
<td><code>Kernel</code></td>
<td>Weighted regions</td>
<td>Gaussian-weighted, gradient-based</td>
</tr>
</tbody>
</table>
</div>
<div id="quick-start" class="section level2">
<h2>Quick Start</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># Load the package</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">library</span>(neuroim2)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co"># Read a brain volume</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>file_name <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;global_mask2.nii.gz&quot;</span>, <span class="at">package=</span><span class="st">&quot;neuroim2&quot;</span>)</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>vol <span class="ot">&lt;-</span> <span class="fu">read_vol</span>(file_name)</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="co"># Create a simple spherical ROI</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>roi <span class="ot">&lt;-</span> <span class="fu">spherical_roi</span>(vol, <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>), <span class="at">radius =</span> <span class="dv">5</span>)</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;ROI contains&quot;</span>, <span class="fu">length</span>(roi), <span class="st">&quot;voxels</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">#&gt; ROI contains 11 voxels</span></span></code></pre></div>
<hr />
</div>
</div>
<div id="basic-roi-operations" class="section level1">
<h1>Basic ROI Operations</h1>
<div id="creating-a-spherical-roi" class="section level2">
<h2>Creating a Spherical ROI</h2>
<p>Spherical ROIs are the most commonly used type in neuroimaging.
They’re particularly useful for searchlight analyses and seed-based
connectivity studies.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># Load an example brain volume</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>file_name <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;global_mask2.nii.gz&quot;</span>, <span class="at">package=</span><span class="st">&quot;neuroim2&quot;</span>)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>vol <span class="ot">&lt;-</span> <span class="fu">read_vol</span>(file_name)</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co"># Create a spherical ROI centered at voxel coordinates [20,20,20]</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co"># with a 5mm radius, filling all values with 100</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>sphere <span class="ot">&lt;-</span> <span class="fu">spherical_roi</span>(vol, <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>), <span class="at">radius =</span> <span class="dv">5</span>, <span class="at">fill =</span> <span class="dv">100</span>)</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co"># Examine the ROI</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Number of voxels in ROI:&quot;</span>, <span class="fu">length</span>(sphere), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co">#&gt; Number of voxels in ROI: 11</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;ROI dimensions:&quot;</span>, <span class="fu">dim</span>(sphere), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="co">#&gt; ROI dimensions: 11 3</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;All values are 100:&quot;</span>, <span class="fu">all</span>(sphere <span class="sc">==</span> <span class="dv">100</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="co">#&gt; All values are 100: TRUE</span></span></code></pre></div>
<div id="performance-note-c-vs-pure-r-implementation" class="section level3">
<h3>Performance Note: C++ vs Pure R Implementation</h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># The spherical_roi function can use either C++ (fast) or pure R (slower)</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co"># C++ is the default and recommended for performance</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>sphere_cpp <span class="ot">&lt;-</span> <span class="fu">spherical_roi</span>(vol, <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>), <span class="at">radius =</span> <span class="dv">5</span>, <span class="at">use_cpp =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>sphere_r <span class="ot">&lt;-</span> <span class="fu">spherical_roi</span>(vol, <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>), <span class="at">radius =</span> <span class="dv">5</span>, <span class="at">use_cpp =</span> <span class="cn">FALSE</span>)</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="co"># Both produce the same result</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="fu">identical</span>(<span class="fu">coords</span>(sphere_cpp), <span class="fu">coords</span>(sphere_r))</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
</div>
</div>
<div id="creating-a-spherical-roi-around-real-world-coordinates" class="section level2">
<h2>Creating a Spherical ROI Around Real-World Coordinates</h2>
<p>Often, you’ll have coordinates in millimeter space (e.g., from
published studies) rather than voxel indices.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># Define a real-world coordinate in mm</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>rpoint <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">34</span>, <span class="sc">-</span><span class="dv">28</span>, <span class="dv">10</span>)</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co"># Convert real-world coordinates to voxel coordinates</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>vox <span class="ot">&lt;-</span> <span class="fu">coord_to_grid</span>(vol, rpoint)</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Real coordinate:&quot;</span>, rpoint, <span class="st">&quot;-&gt; Voxel coordinate:&quot;</span>, vox, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">#&gt; Real coordinate: -34 -28 10 -&gt; Voxel coordinate: 42.71428 24.00001 16.2027</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="co"># Create spherical ROI with 10mm radius</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>sphere <span class="ot">&lt;-</span> <span class="fu">spherical_roi</span>(vol, vox, <span class="at">radius =</span> <span class="dv">10</span>, <span class="at">fill =</span> <span class="dv">1</span>)</span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;ROI contains&quot;</span>, <span class="fu">length</span>(sphere), <span class="st">&quot;voxels</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co">#&gt; ROI contains 85 voxels</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co"># Verify the center of mass is close to our target</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">index_to_coord</span>(vol, <span class="fu">indices</span>(sphere))</span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>center_of_mass <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(coords)</span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Center of mass:&quot;</span>, center_of_mass, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a><span class="co">#&gt; Center of mass: -36.75 -22.75 14.8</span></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Original point:&quot;</span>, rpoint, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a><span class="co">#&gt; Original point: -34 -28 10</span></span></code></pre></div>
</div>
<div id="creating-multiple-spherical-rois-efficiently" class="section level2">
<h2>Creating Multiple Spherical ROIs Efficiently</h2>
<p>When creating many ROIs, use the vectorized
<code>spherical_roi_set()</code> function for better performance:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">library</span>(neuroim2)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>vol <span class="ot">&lt;-</span> <span class="fu">read_vol</span>(<span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;global_mask_v4.nii&quot;</span>, <span class="at">package =</span> <span class="st">&quot;neuroim2&quot;</span>))</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">dim</span>(vol)</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co"># Define multiple ROI centers</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>centers <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fu">floor</span>(d[<span class="dv">1</span>]<span class="sc">/</span><span class="dv">3</span>), <span class="fu">floor</span>(d[<span class="dv">2</span>]<span class="sc">/</span><span class="dv">3</span>), <span class="fu">floor</span>(d[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">3</span>)),</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fu">floor</span>(d[<span class="dv">1</span>]<span class="sc">/</span><span class="dv">2</span>), <span class="fu">floor</span>(d[<span class="dv">2</span>]<span class="sc">/</span><span class="dv">2</span>), <span class="fu">floor</span>(d[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">2</span>)),</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fu">floor</span>(<span class="dv">2</span><span class="sc">*</span>d[<span class="dv">1</span>]<span class="sc">/</span><span class="dv">3</span>), <span class="fu">floor</span>(<span class="dv">2</span><span class="sc">*</span>d[<span class="dv">2</span>]<span class="sc">/</span><span class="dv">3</span>), <span class="fu">floor</span>(<span class="dv">2</span><span class="sc">*</span>d[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">3</span>))</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>)</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="co"># Efficient vectorized creation</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>rois <span class="ot">&lt;-</span> <span class="fu">spherical_roi_set</span>(<span class="at">bvol =</span> vol, <span class="at">centroids =</span> centers, <span class="at">radius =</span> <span class="dv">5</span>, <span class="at">fill =</span> <span class="dv">1</span>)</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Created&quot;</span>, <span class="fu">length</span>(rois), <span class="st">&quot;ROIs</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="co">#&gt; Created 3 ROIs</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a><span class="co"># Compare with loop approach (slower but equivalent)</span></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>rois2 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq_len</span>(<span class="fu">nrow</span>(centers)), <span class="cf">function</span>(i) {</span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>  <span class="fu">spherical_roi</span>(vol, centers[i,], <span class="dv">5</span>, <span class="at">fill =</span> <span class="dv">1</span>)</span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a>})</span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Loop method also created&quot;</span>, <span class="fu">length</span>(rois2), <span class="st">&quot;ROIs</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a><span class="co">#&gt; Loop method also created 3 ROIs</span></span></code></pre></div>
</div>
<div id="creating-cuboid-and-square-rois" class="section level2">
<h2>Creating Cuboid and Square ROIs</h2>
<div id="cuboid-rois-3d-boxes" class="section level3">
<h3>Cuboid ROIs (3D boxes)</h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># Create a cuboid ROI - a 3D rectangular box</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>sp1 <span class="ot">&lt;-</span> <span class="fu">NeuroSpace</span>(<span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>), <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co"># Create a 7x7x7 cube (surround=3 means 3 voxels on each side of center)</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>cube <span class="ot">&lt;-</span> <span class="fu">cuboid_roi</span>(sp1, <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">10</span>), <span class="at">surround =</span> <span class="dv">3</span>, <span class="at">fill =</span> <span class="dv">5</span>)</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Cuboid ROI contains&quot;</span>, <span class="fu">length</span>(cube), <span class="st">&quot;voxels</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co">#&gt; Cuboid ROI contains 343 voxels</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;All values are 5:&quot;</span>, <span class="fu">all</span>(cube <span class="sc">==</span> <span class="dv">5</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#&gt; All values are 5: TRUE</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co"># Get the coordinates</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>vox_coords <span class="ot">&lt;-</span> <span class="fu">coords</span>(cube)</span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Coordinate ranges:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co">#&gt; Coordinate ranges:</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  X:&quot;</span>, <span class="fu">range</span>(vox_coords[,<span class="dv">1</span>]), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a><span class="co">#&gt;   X: 7 13</span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Y:&quot;</span>, <span class="fu">range</span>(vox_coords[,<span class="dv">2</span>]), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a><span class="co">#&gt;   Y: 7 13</span></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Z:&quot;</span>, <span class="fu">range</span>(vox_coords[,<span class="dv">3</span>]), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a><span class="co">#&gt;   Z: 7 13</span></span></code></pre></div>
</div>
<div id="square-rois-2d-in-3d-space" class="section level3">
<h3>Square ROIs (2D in 3D space)</h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># Create a square ROI - a 2D square fixed in one dimension</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>sp1 <span class="ot">&lt;-</span> <span class="fu">NeuroSpace</span>(<span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>), <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co"># Create a 5x5 square in the z=10 plane (fixdim=3 fixes the z dimension)</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>square <span class="ot">&lt;-</span> <span class="fu">square_roi</span>(sp1, <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">10</span>), <span class="at">surround =</span> <span class="dv">2</span>, <span class="at">fill =</span> <span class="dv">3</span>, <span class="at">fixdim =</span> <span class="dv">3</span>)</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Square ROI contains&quot;</span>, <span class="fu">length</span>(square), <span class="st">&quot;voxels (should be 25)</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co">#&gt; Square ROI contains 25 voxels (should be 25)</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co"># Verify it&#39;s planar</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>vox_coords <span class="ot">&lt;-</span> <span class="fu">coords</span>(square)</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;All z-coordinates are the same:&quot;</span>, </span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>    <span class="fu">length</span>(<span class="fu">unique</span>(vox_coords[,<span class="dv">3</span>])) <span class="sc">==</span> <span class="dv">1</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="co">#&gt; All z-coordinates are the same: TRUE</span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Z-plane:&quot;</span>, <span class="fu">unique</span>(vox_coords[,<span class="dv">3</span>]), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="co">#&gt; Z-plane: 10</span></span></code></pre></div>
<hr />
</div>
</div>
</div>
<div id="working-with-roi-data" class="section level1">
<h1>Working with ROI Data</h1>
<div id="converting-rois-to-sparse-volumes" class="section level2">
<h2>Converting ROIs to Sparse Volumes</h2>
<p>Sparse volumes are memory-efficient representations that only store
non-zero values:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># Create a spherical ROI</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>sphere <span class="ot">&lt;-</span> <span class="fu">spherical_roi</span>(vol, <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">10</span>, <span class="dv">10</span>), <span class="at">radius =</span> <span class="dv">10</span>, <span class="at">fill =</span> <span class="dv">1</span>)</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;ROI contains&quot;</span>, <span class="fu">length</span>(sphere), <span class="st">&quot;voxels</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="co">#&gt; ROI contains 85 voxels</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co"># Convert to SparseNeuroVol - memory efficient storage</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co"># Prefer the provided coercion helper</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>sparsevol <span class="ot">&lt;-</span> <span class="fu">as.sparse</span>(sphere)</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="co"># Verify properties</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Sum of values match:&quot;</span>, <span class="fu">sum</span>(sparsevol) <span class="sc">==</span> <span class="fu">sum</span>(sphere), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">#&gt; Sum of values match: TRUE</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Dimensions match:&quot;</span>, <span class="fu">all</span>(<span class="fu">dim</span>(sparsevol) <span class="sc">==</span> <span class="fu">dim</span>(vol)), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="co">#&gt; Dimensions match: TRUE</span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a><span class="co"># Memory comparison</span></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a>roi_size <span class="ot">&lt;-</span> <span class="fu">object.size</span>(sphere)</span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a>sparse_size <span class="ot">&lt;-</span> <span class="fu">object.size</span>(sparsevol)</span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Memory usage - ROI:&quot;</span>, <span class="fu">format</span>(roi_size, <span class="at">units =</span> <span class="st">&quot;auto&quot;</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a><span class="co">#&gt; Memory usage - ROI: 9.8 Kb</span></span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Memory usage - Sparse:&quot;</span>, <span class="fu">format</span>(sparse_size, <span class="at">units =</span> <span class="st">&quot;auto&quot;</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a><span class="co">#&gt; Memory usage - Sparse: 8.9 Kb</span></span></code></pre></div>
</div>
<div id="extracting-time-series-from-rois-4d-data" class="section level2">
<h2>Extracting Time-Series from ROIs (4D Data)</h2>
<p>ROIs are particularly useful for extracting time-series from 4D
functional data:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># Load a 4D dataset (using mask file as example - normally this would be fMRI data)</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>vec4d <span class="ot">&lt;-</span> <span class="fu">read_vec</span>(<span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;global_mask_v4.nii&quot;</span>, <span class="at">package =</span> <span class="st">&quot;neuroim2&quot;</span>))</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;4D data dimensions:&quot;</span>, <span class="fu">dim</span>(vec4d), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="co">#&gt; 4D data dimensions: 64 64 25 4</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="co"># Create an ROI</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>roi <span class="ot">&lt;-</span> <span class="fu">spherical_roi</span>(vol, <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">12</span>, <span class="dv">12</span>), <span class="at">radius =</span> <span class="dv">6</span>)</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="co"># Extract time-series from the ROI</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>roi_series <span class="ot">&lt;-</span> <span class="fu">series_roi</span>(vec4d, roi)</span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;ROI time-series dimensions:&quot;</span>, <span class="fu">dim</span>(roi_series), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="co">#&gt; ROI time-series dimensions: 19 3</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a><span class="co"># Get mean time-series across ROI (average across voxels)</span></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a>mat_roi <span class="ot">&lt;-</span> <span class="fu">values</span>(roi_series)      <span class="co"># T x N matrix</span></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a>mean_series <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(mat_roi)   <span class="co"># length equals time dimension</span></span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Mean time-series length:&quot;</span>, <span class="fu">length</span>(mean_series), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a><span class="co">#&gt; Mean time-series length: 4</span></span></code></pre></div>
</div>
<div id="using-roivec-for-4d-roi-data" class="section level2">
<h2>Using ROIVec for 4D ROI Data</h2>
<p>The <code>ROIVec</code> class is designed for efficient storage of 4D
ROI data:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># Create a 4D NeuroSpace</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>vspace <span class="ot">&lt;-</span> <span class="fu">NeuroSpace</span>(<span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">20</span>), <span class="at">spacing =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="co"># Define ROI coordinates</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>roi_coords <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>, <span class="dv">6</span>,<span class="dv">5</span>,<span class="dv">5</span>, <span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">5</span>, <span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">6</span>), <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="co"># Create synthetic time-series data for each voxel</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>n_timepoints <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>n_voxels <span class="ot">&lt;-</span> <span class="fu">nrow</span>(roi_coords)</span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>roi_data <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(n_timepoints <span class="sc">*</span> n_voxels), </span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>                   <span class="at">nrow =</span> n_timepoints, <span class="at">ncol =</span> n_voxels)</span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="co"># Create ROIVec object</span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a>roi_vec <span class="ot">&lt;-</span> <span class="fu">ROIVec</span>(vspace, roi_coords, roi_data)</span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;ROIVec created with&quot;</span>, <span class="fu">nrow</span>(roi_coords), <span class="st">&quot;voxels and&quot;</span>, </span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a>    <span class="fu">nrow</span>(roi_data), <span class="st">&quot;timepoints</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a><span class="co">#&gt; ROIVec created with 4 voxels and 20 timepoints</span></span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a><span class="co"># Access as matrix of values (T x N)</span></span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a>roi_matrix <span class="ot">&lt;-</span> <span class="fu">values</span>(roi_vec)</span>
<span id="cb12-21"><a href="#cb12-21" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Matrix dimensions (T x N):&quot;</span>, <span class="fu">dim</span>(roi_matrix), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb12-22"><a href="#cb12-22" tabindex="-1"></a><span class="co">#&gt; Matrix dimensions (T x N): 20 4</span></span></code></pre></div>
<hr />
</div>
</div>
<div id="searchlight-analyses" class="section level1">
<h1>Searchlight Analyses</h1>
<p>Searchlight analysis is a powerful technique for multivariate pattern
analysis that examines local neighborhoods throughout the brain.</p>
<div id="basic-searchlight" class="section level2">
<h2>Basic Searchlight</h2>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co"># Generate exhaustive searchlight covering all voxels</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>slist <span class="ot">&lt;-</span> <span class="fu">searchlight</span>(vol, <span class="at">eager =</span> <span class="cn">TRUE</span>, <span class="at">radius =</span> <span class="dv">8</span>)</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Number of searchlights:&quot;</span>, <span class="fu">length</span>(slist), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="co">#&gt; Number of searchlights: 29532</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="co"># Compute mean value in each searchlight</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>searchlight_means <span class="ot">&lt;-</span> slist <span class="sc">%&gt;%</span> </span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map_dbl</span>(<span class="sc">~</span> <span class="fu">mean</span>(vol[<span class="fu">coords</span>(.)]))</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Computed means for&quot;</span>, <span class="fu">length</span>(searchlight_means), <span class="st">&quot;searchlights</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a><span class="co">#&gt; Computed means for 29532 searchlights</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Mean range:&quot;</span>, <span class="fu">range</span>(searchlight_means, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a><span class="co">#&gt; Mean range: 0.02040816 1</span></span></code></pre></div>
</div>
<div id="randomized-searchlight" class="section level2">
<h2>Randomized Searchlight</h2>
<p>Randomized searchlight samples voxels without replacement, ensuring
coverage while reducing redundancy:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># Randomized searchlight - each voxel appears in at least one searchlight</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)  <span class="co"># For reproducibility</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>random_lights <span class="ot">&lt;-</span> vol <span class="sc">%&gt;%</span> </span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>  <span class="fu">random_searchlight</span>(<span class="at">radius =</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map_dbl</span>(<span class="sc">~</span> <span class="fu">mean</span>(vol[<span class="fu">coords</span>(.)]))</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Random searchlight count:&quot;</span>, <span class="fu">length</span>(random_lights), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="co">#&gt; Random searchlight count: 2082</span></span></code></pre></div>
</div>
<div id="clustered-searchlight" class="section level2">
<h2>Clustered Searchlight</h2>
<p>Use anatomical or functional parcellations to define ROIs:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># Create a clustering over the voxel space</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">index_to_coord</span>(vol, <span class="fu">which</span>(vol <span class="sc">&gt;</span> <span class="dv">0</span>))</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>kres <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(grid, <span class="at">centers =</span> <span class="dv">50</span>, <span class="at">iter.max =</span> <span class="dv">500</span>)</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="co"># Create ClusteredNeuroVol</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>kvol <span class="ot">&lt;-</span> <span class="fu">ClusteredNeuroVol</span>(vol, kres<span class="sc">$</span>cluster)</span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Created&quot;</span>, <span class="fu">length</span>(<span class="fu">unique</span>(kres<span class="sc">$</span>cluster)), <span class="st">&quot;clusters</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="co">#&gt; Created 50 clusters</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a><span class="co"># Run clustered searchlight</span></span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a>cluster_means <span class="ot">&lt;-</span> vol <span class="sc">%&gt;%</span> </span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a>  <span class="fu">clustered_searchlight</span>(<span class="at">cvol =</span> kvol) <span class="sc">%&gt;%</span> </span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map_dbl</span>(<span class="sc">~</span> <span class="fu">mean</span>(vol[<span class="fu">coords</span>(.)]))</span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Cluster mean range:&quot;</span>, <span class="fu">range</span>(cluster_means, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a><span class="co">#&gt; Cluster mean range: 1 1</span></span></code></pre></div>
<hr />
</div>
</div>
<div id="image-patches" class="section level1">
<h1>Image Patches</h1>
<p>Patches are regular, fixed-size regions that tile the image space,
useful for convolutional approaches:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="co"># Create 3x3x1 patches covering the volume</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>pset <span class="ot">&lt;-</span> <span class="fu">patch_set</span>(vol, <span class="at">dims =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">1</span>))</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Number of patches:&quot;</span>, <span class="fu">length</span>(pset), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="co">#&gt; Number of patches: 102400</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="co"># Compute statistics for each patch</span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>patch_means <span class="ot">&lt;-</span> pset <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">map_dbl</span>(<span class="sc">~</span> <span class="fu">mean</span>(.))</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Patch mean range:&quot;</span>, <span class="fu">range</span>(patch_means, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="co">#&gt; Patch mean range: 0 1</span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a><span class="co"># Restrict patches to masked regions only</span></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a>pset_masked <span class="ot">&lt;-</span> <span class="fu">patch_set</span>(vol, <span class="at">dims =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">1</span>), <span class="at">mask =</span> <span class="fu">as.logical</span>(vol))</span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Masked patches:&quot;</span>, <span class="fu">length</span>(pset_masked), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a><span class="co">#&gt; Masked patches: 29532</span></span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a><span class="co"># Patches are guaranteed to be equal size (padded at edges if needed)</span></span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a>patch_sizes <span class="ot">&lt;-</span> pset_masked <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">map_int</span>(<span class="sc">~</span> <span class="fu">length</span>(.))</span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;All patches same size:&quot;</span>, <span class="fu">length</span>(<span class="fu">unique</span>(patch_sizes)) <span class="sc">==</span> <span class="dv">1</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a><span class="co">#&gt; All patches same size: TRUE</span></span>
<span id="cb16-20"><a href="#cb16-20" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Patch size:&quot;</span>, <span class="fu">unique</span>(patch_sizes), <span class="st">&quot;voxels</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb16-21"><a href="#cb16-21" tabindex="-1"></a><span class="co">#&gt; Patch size: 18 voxels</span></span></code></pre></div>
<hr />
</div>
<div id="advanced-roi-techniques" class="section level1">
<h1>Advanced ROI Techniques</h1>
<div id="custom-weighted-rois-with-kernels" class="section level2">
<h2>Custom Weighted ROIs with Kernels</h2>
<p>Create Gaussian-weighted or other custom-shaped ROIs:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co"># Create a Gaussian kernel for weighted ROI</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>kern_dim <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>)  <span class="co"># 5x5x5 kernel</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>voxel_dim <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>)  <span class="co"># 1mm isotropic voxels</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="co"># Create Gaussian-weighted kernel</span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>gauss_kernel <span class="ot">&lt;-</span> <span class="fu">Kernel</span>(<span class="at">kerndim =</span> kern_dim, <span class="at">vdim =</span> voxel_dim, </span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>                       <span class="at">FUN =</span> dnorm, <span class="at">sd =</span> <span class="fl">1.5</span>)</span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a><span class="co"># Embed kernel at a specific location</span></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a>embedded <span class="ot">&lt;-</span> <span class="fu">embed_kernel</span>(gauss_kernel, <span class="fu">space</span>(vol), </span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a>                         <span class="at">center_voxel =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>))</span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Kernel weights sum to:&quot;</span>, <span class="fu">sum</span>(embedded), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a><span class="co">#&gt; Kernel weights sum to: 1</span></span></code></pre></div>
</div>
<div id="working-with-clusteredneurovec-for-parcellated-data" class="section level2">
<h2>Working with ClusteredNeuroVec for Parcellated Data</h2>
<p>Efficiently handle parcellated 4D data where voxels are grouped into
regions:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="co"># Create synthetic 4D data</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>sp4 <span class="ot">&lt;-</span> <span class="fu">NeuroSpace</span>(<span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">20</span>), <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>arr <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">rnorm</span>(<span class="dv">10</span><span class="sc">*</span><span class="dv">10</span><span class="sc">*</span><span class="dv">10</span><span class="sc">*</span><span class="dv">20</span>), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">20</span>))</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">NeuroVec</span>(arr, sp4)</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a><span class="co"># Create mask for central region</span></span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>sp3 <span class="ot">&lt;-</span> <span class="fu">NeuroSpace</span>(<span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">10</span>), <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a>mask_arr <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">FALSE</span>, <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a>mask_arr[<span class="dv">3</span><span class="sc">:</span><span class="dv">8</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">8</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">8</span>] <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a>mask <span class="ot">&lt;-</span> <span class="fu">LogicalNeuroVol</span>(mask_arr, sp3)</span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a><span class="co"># Assign voxels to 5 random clusters</span></span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a>n_voxels <span class="ot">&lt;-</span> <span class="fu">sum</span>(mask_arr)</span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, n_voxels, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-15"><a href="#cb18-15" tabindex="-1"></a>cvol <span class="ot">&lt;-</span> <span class="fu">ClusteredNeuroVol</span>(mask, clusters)</span>
<span id="cb18-16"><a href="#cb18-16" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" tabindex="-1"></a><span class="co"># Create clustered representation - one time-series per cluster</span></span>
<span id="cb18-18"><a href="#cb18-18" tabindex="-1"></a>cv <span class="ot">&lt;-</span> <span class="fu">ClusteredNeuroVec</span>(vec, cvol)</span>
<span id="cb18-19"><a href="#cb18-19" tabindex="-1"></a></span>
<span id="cb18-20"><a href="#cb18-20" tabindex="-1"></a><span class="co"># Access cluster time-series efficiently</span></span>
<span id="cb18-21"><a href="#cb18-21" tabindex="-1"></a>cluster_matrix <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(cv)  <span class="co"># T x K matrix</span></span>
<span id="cb18-22"><a href="#cb18-22" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Cluster matrix dimensions:&quot;</span>, <span class="fu">dim</span>(cluster_matrix), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb18-23"><a href="#cb18-23" tabindex="-1"></a><span class="co">#&gt; Cluster matrix dimensions: 20 5</span></span>
<span id="cb18-24"><a href="#cb18-24" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;(&quot;</span>, <span class="fu">dim</span>(cluster_matrix)[<span class="dv">1</span>], <span class="st">&quot;timepoints x&quot;</span>, </span>
<span id="cb18-25"><a href="#cb18-25" tabindex="-1"></a>    <span class="fu">dim</span>(cluster_matrix)[<span class="dv">2</span>], <span class="st">&quot;clusters)</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb18-26"><a href="#cb18-26" tabindex="-1"></a><span class="co">#&gt; ( 20 timepoints x 5 clusters)</span></span></code></pre></div>
</div>
<div id="roi-set-operations" class="section level2">
<h2>ROI Set Operations</h2>
<p>Combine and manipulate multiple ROIs:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="co"># Create two overlapping spherical ROIs</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>roi1 <span class="ot">&lt;-</span> <span class="fu">spherical_roi</span>(vol, <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>), <span class="at">radius =</span> <span class="dv">6</span>, <span class="at">fill =</span> <span class="dv">1</span>)</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>roi2 <span class="ot">&lt;-</span> <span class="fu">spherical_roi</span>(vol, <span class="fu">c</span>(<span class="dv">23</span>, <span class="dv">20</span>, <span class="dv">20</span>), <span class="at">radius =</span> <span class="dv">6</span>, <span class="at">fill =</span> <span class="dv">1</span>)</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="co"># Get indices for set operations</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>idx1 <span class="ot">&lt;-</span> <span class="fu">indices</span>(roi1)</span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>idx2 <span class="ot">&lt;-</span> <span class="fu">indices</span>(roi2)</span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a><span class="co"># Intersection - voxels in both ROIs</span></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a>intersection_idx <span class="ot">&lt;-</span> <span class="fu">intersect</span>(idx1, idx2)</span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Intersection:&quot;</span>, <span class="fu">length</span>(intersection_idx), <span class="st">&quot;voxels</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a><span class="co">#&gt; Intersection: 0 voxels</span></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a><span class="co"># Union - voxels in either ROI</span></span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a>union_idx <span class="ot">&lt;-</span> <span class="fu">union</span>(idx1, idx2)</span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Union:&quot;</span>, <span class="fu">length</span>(union_idx), <span class="st">&quot;voxels</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb19-17"><a href="#cb19-17" tabindex="-1"></a><span class="co">#&gt; Union: 38 voxels</span></span>
<span id="cb19-18"><a href="#cb19-18" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" tabindex="-1"></a><span class="co"># Difference - voxels in roi1 but not roi2</span></span>
<span id="cb19-20"><a href="#cb19-20" tabindex="-1"></a>diff_idx <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(idx1, idx2)</span>
<span id="cb19-21"><a href="#cb19-21" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Difference (roi1 - roi2):&quot;</span>, <span class="fu">length</span>(diff_idx), <span class="st">&quot;voxels</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb19-22"><a href="#cb19-22" tabindex="-1"></a><span class="co">#&gt; Difference (roi1 - roi2): 19 voxels</span></span>
<span id="cb19-23"><a href="#cb19-23" tabindex="-1"></a></span>
<span id="cb19-24"><a href="#cb19-24" tabindex="-1"></a><span class="co"># Calculate overlap percentage</span></span>
<span id="cb19-25"><a href="#cb19-25" tabindex="-1"></a>overlap_pct <span class="ot">&lt;-</span> <span class="fu">length</span>(intersection_idx) <span class="sc">/</span> <span class="fu">length</span>(union_idx) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb19-26"><a href="#cb19-26" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Overlap:&quot;</span>, <span class="fu">round</span>(overlap_pct, <span class="dv">1</span>), <span class="st">&quot;%</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb19-27"><a href="#cb19-27" tabindex="-1"></a><span class="co">#&gt; Overlap: 0 %</span></span></code></pre></div>
<hr />
</div>
</div>
<div id="best-practices-and-performance" class="section level1">
<h1>Best Practices and Performance</h1>
<div id="memory-management" class="section level2">
<h2>Memory Management</h2>
<p>When working with many ROIs, consider memory usage:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="co"># Compare memory usage of different ROI storage methods</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>n_rois <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>centers <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">runif</span>(n_rois <span class="sc">*</span> <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">15</span>), <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a><span class="co"># Method 1: List of ROI objects (flexible but more memory)</span></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>  roi_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(centers), <span class="cf">function</span>(i) {</span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>  <span class="fu">spherical_roi</span>(vol, centers[i,], <span class="at">radius =</span> <span class="dv">6</span>, <span class="at">fill =</span> <span class="dv">1</span>)</span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a>  })</span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a><span class="co"># Method 2: Single sparse volume with labeled regions (ensure increasing indices)</span></span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a>all_indices <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a>all_labels <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(centers)) {</span>
<span id="cb20-14"><a href="#cb20-14" tabindex="-1"></a>  roi <span class="ot">&lt;-</span> <span class="fu">spherical_roi</span>(vol, centers[i,], <span class="at">radius =</span> <span class="dv">6</span>)</span>
<span id="cb20-15"><a href="#cb20-15" tabindex="-1"></a>  idx <span class="ot">&lt;-</span> <span class="fu">indices</span>(roi)</span>
<span id="cb20-16"><a href="#cb20-16" tabindex="-1"></a>  idx <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(idx))</span>
<span id="cb20-17"><a href="#cb20-17" tabindex="-1"></a>  all_indices[[i]] <span class="ot">&lt;-</span> idx</span>
<span id="cb20-18"><a href="#cb20-18" tabindex="-1"></a>  all_labels[[i]] <span class="ot">&lt;-</span> <span class="fu">rep</span>(i, <span class="fu">length</span>(idx))</span>
<span id="cb20-19"><a href="#cb20-19" tabindex="-1"></a>}</span>
<span id="cb20-20"><a href="#cb20-20" tabindex="-1"></a>idx_all <span class="ot">&lt;-</span> <span class="fu">unlist</span>(all_indices)</span>
<span id="cb20-21"><a href="#cb20-21" tabindex="-1"></a>lab_all <span class="ot">&lt;-</span> <span class="fu">unlist</span>(all_labels)</span>
<span id="cb20-22"><a href="#cb20-22" tabindex="-1"></a>ord <span class="ot">&lt;-</span> <span class="fu">order</span>(idx_all)</span>
<span id="cb20-23"><a href="#cb20-23" tabindex="-1"></a>idx_all <span class="ot">&lt;-</span> idx_all[ord]</span>
<span id="cb20-24"><a href="#cb20-24" tabindex="-1"></a>lab_all <span class="ot">&lt;-</span> lab_all[ord]</span>
<span id="cb20-25"><a href="#cb20-25" tabindex="-1"></a><span class="co"># Ensure strictly increasing indices by removing duplicates</span></span>
<span id="cb20-26"><a href="#cb20-26" tabindex="-1"></a>keep <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">duplicated</span>(idx_all)</span>
<span id="cb20-27"><a href="#cb20-27" tabindex="-1"></a>idx_all <span class="ot">&lt;-</span> idx_all[keep]</span>
<span id="cb20-28"><a href="#cb20-28" tabindex="-1"></a>lab_all <span class="ot">&lt;-</span> lab_all[keep]</span>
<span id="cb20-29"><a href="#cb20-29" tabindex="-1"></a>combined_sparse <span class="ot">&lt;-</span> <span class="fu">SparseNeuroVol</span>(lab_all, <span class="fu">space</span>(vol), <span class="at">indices =</span> idx_all)</span>
<span id="cb20-30"><a href="#cb20-30" tabindex="-1"></a></span>
<span id="cb20-31"><a href="#cb20-31" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Memory usage:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb20-32"><a href="#cb20-32" tabindex="-1"></a><span class="co">#&gt; Memory usage:</span></span>
<span id="cb20-33"><a href="#cb20-33" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  ROI list:&quot;</span>, <span class="fu">format</span>(<span class="fu">object.size</span>(roi_list), <span class="at">units =</span> <span class="st">&quot;auto&quot;</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb20-34"><a href="#cb20-34" tabindex="-1"></a><span class="co">#&gt;   ROI list: 771.1 Kb</span></span>
<span id="cb20-35"><a href="#cb20-35" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Sparse combined:&quot;</span>, <span class="fu">format</span>(<span class="fu">object.size</span>(combined_sparse), <span class="at">units =</span> <span class="st">&quot;auto&quot;</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb20-36"><a href="#cb20-36" tabindex="-1"></a><span class="co">#&gt;   Sparse combined: 23.7 Kb</span></span></code></pre></div>
</div>
<div id="choosing-roi-sizes" class="section level2">
<h2>Choosing ROI Sizes</h2>
<p>Guidelines for selecting appropriate ROI sizes:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="co"># Demonstrate effect of ROI size on coverage and overlap</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>radii <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">10</span>, <span class="dv">12</span>)</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>coverage_stats <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>  <span class="at">radius =</span> radii,</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>  <span class="at">n_voxels =</span> <span class="fu">numeric</span>(<span class="fu">length</span>(radii)),</span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>  <span class="at">pct_overlap =</span> <span class="fu">numeric</span>(<span class="fu">length</span>(radii))</span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>)</span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a>center1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>)</span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a>center2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">20</span>, <span class="dv">20</span>)  <span class="co"># 5 voxels apart</span></span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(radii)) {</span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a>  roi1 <span class="ot">&lt;-</span> <span class="fu">spherical_roi</span>(vol, center1, <span class="at">radius =</span> radii[i])</span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a>  roi2 <span class="ot">&lt;-</span> <span class="fu">spherical_roi</span>(vol, center2, <span class="at">radius =</span> radii[i])</span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a>  </span>
<span id="cb21-16"><a href="#cb21-16" tabindex="-1"></a>  coverage_stats<span class="sc">$</span>n_voxels[i] <span class="ot">&lt;-</span> <span class="fu">length</span>(roi1)</span>
<span id="cb21-17"><a href="#cb21-17" tabindex="-1"></a>  </span>
<span id="cb21-18"><a href="#cb21-18" tabindex="-1"></a>  overlap <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">intersect</span>(<span class="fu">indices</span>(roi1), <span class="fu">indices</span>(roi2)))</span>
<span id="cb21-19"><a href="#cb21-19" tabindex="-1"></a>  total <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">union</span>(<span class="fu">indices</span>(roi1), <span class="fu">indices</span>(roi2)))</span>
<span id="cb21-20"><a href="#cb21-20" tabindex="-1"></a>  coverage_stats<span class="sc">$</span>pct_overlap[i] <span class="ot">&lt;-</span> overlap <span class="sc">/</span> total <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb21-21"><a href="#cb21-21" tabindex="-1"></a>}</span>
<span id="cb21-22"><a href="#cb21-22" tabindex="-1"></a></span>
<span id="cb21-23"><a href="#cb21-23" tabindex="-1"></a><span class="fu">print</span>(coverage_stats)</span>
<span id="cb21-24"><a href="#cb21-24" tabindex="-1"></a><span class="co">#&gt;   radius n_voxels pct_overlap</span></span>
<span id="cb21-25"><a href="#cb21-25" tabindex="-1"></a><span class="co">#&gt; 1      6       19    0.000000</span></span>
<span id="cb21-26"><a href="#cb21-26" tabindex="-1"></a><span class="co">#&gt; 2      8       49    0.000000</span></span>
<span id="cb21-27"><a href="#cb21-27" tabindex="-1"></a><span class="co">#&gt; 3     10       85    0.000000</span></span>
<span id="cb21-28"><a href="#cb21-28" tabindex="-1"></a><span class="co">#&gt; 4     12      163    5.844156</span></span></code></pre></div>
</div>
<div id="parallel-processing-tips" class="section level2">
<h2>Parallel Processing Tips</h2>
<p>For large-scale ROI analyses, consider parallel processing:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="co"># Example of parallel searchlight analysis (not run in vignette)</span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="fu">library</span>(parallel)</span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a><span class="fu">library</span>(foreach)</span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a><span class="fu">library</span>(doParallel)</span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a><span class="co"># Setup parallel backend</span></span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a>n_cores <span class="ot">&lt;-</span> <span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb22-8"><a href="#cb22-8" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(n_cores)</span>
<span id="cb22-9"><a href="#cb22-9" tabindex="-1"></a><span class="fu">registerDoParallel</span>(cl)</span>
<span id="cb22-10"><a href="#cb22-10" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" tabindex="-1"></a><span class="co"># Parallel searchlight computation</span></span>
<span id="cb22-12"><a href="#cb22-12" tabindex="-1"></a>searchlight_results <span class="ot">&lt;-</span> <span class="fu">foreach</span>(<span class="at">roi =</span> searchlight_list, </span>
<span id="cb22-13"><a href="#cb22-13" tabindex="-1"></a>                               <span class="at">.packages =</span> <span class="fu">c</span>(<span class="st">&quot;neuroim2&quot;</span>)) <span class="sc">%dopar%</span> {</span>
<span id="cb22-14"><a href="#cb22-14" tabindex="-1"></a>  <span class="co"># Your analysis function here</span></span>
<span id="cb22-15"><a href="#cb22-15" tabindex="-1"></a>  <span class="fu">mean</span>(data[<span class="fu">coords</span>(roi)])</span>
<span id="cb22-16"><a href="#cb22-16" tabindex="-1"></a>}</span>
<span id="cb22-17"><a href="#cb22-17" tabindex="-1"></a></span>
<span id="cb22-18"><a href="#cb22-18" tabindex="-1"></a><span class="co"># Clean up</span></span>
<span id="cb22-19"><a href="#cb22-19" tabindex="-1"></a><span class="fu">stopCluster</span>(cl)</span></code></pre></div>
<hr />
</div>
</div>
<div id="troubleshooting-and-tips" class="section level1">
<h1>Troubleshooting and Tips</h1>
<div id="common-issues-and-solutions" class="section level2">
<h2>Common Issues and Solutions</h2>
<div id="issue-roi-extends-outside-brain-mask" class="section level3">
<h3>Issue: ROI extends outside brain mask</h3>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="co"># Problem: ROI at edge of brain</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>edge_vox <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>)  <span class="co"># Near edge of volume</span></span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a><span class="co"># Solution 1: Use nonzero=TRUE to keep only mask voxels</span></span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>roi_filtered <span class="ot">&lt;-</span> <span class="fu">spherical_roi</span>(vol, edge_vox, <span class="at">radius =</span> <span class="dv">5</span>, <span class="at">nonzero =</span> <span class="cn">TRUE</span>)</span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Filtered ROI size:&quot;</span>, <span class="fu">length</span>(roi_filtered), <span class="st">&quot;voxels</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a><span class="co">#&gt; Filtered ROI size: 0 voxels</span></span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" tabindex="-1"></a><span class="co"># Solution 2: Check if ROI is valid before analysis</span></span>
<span id="cb23-10"><a href="#cb23-10" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(roi_filtered) <span class="sc">&lt;</span> <span class="dv">10</span>) {</span>
<span id="cb23-11"><a href="#cb23-11" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Warning: ROI too small for reliable analysis</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb23-12"><a href="#cb23-12" tabindex="-1"></a>}</span>
<span id="cb23-13"><a href="#cb23-13" tabindex="-1"></a><span class="co">#&gt; Warning: ROI too small for reliable analysis</span></span></code></pre></div>
</div>
<div id="issue-different-coordinate-systems" class="section level3">
<h3>Issue: Different coordinate systems</h3>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="co"># Always verify your coordinate system</span></span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>test_coord_mm <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">34</span>, <span class="sc">-</span><span class="dv">28</span>, <span class="dv">10</span>)  <span class="co"># MNI coordinates</span></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>test_coord_vox <span class="ot">&lt;-</span> <span class="fu">coord_to_grid</span>(vol, test_coord_mm)</span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a><span class="co"># Verify round-trip conversion</span></span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a>back_to_mm <span class="ot">&lt;-</span> <span class="fu">grid_to_coord</span>(vol, <span class="fu">matrix</span>(test_coord_vox, <span class="at">nrow =</span> <span class="dv">1</span>))</span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Original (mm):&quot;</span>, test_coord_mm, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a><span class="co">#&gt; Original (mm): -34 -28 10</span></span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Voxel:&quot;</span>, test_coord_vox, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)  </span>
<span id="cb24-10"><a href="#cb24-10" tabindex="-1"></a><span class="co">#&gt; Voxel: 42.71428 23.85711 16.1892</span></span>
<span id="cb24-11"><a href="#cb24-11" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Back to mm:&quot;</span>, back_to_mm, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb24-12"><a href="#cb24-12" tabindex="-1"></a><span class="co">#&gt; Back to mm: -33.99997 -28.00012 10.00004</span></span></code></pre></div>
<hr />
</div>
</div>
</div>
<div id="see-also" class="section level1">
<h1>See Also</h1>
<p>For related functionality, see these other vignettes and help
pages:</p>
<ul>
<li><code>vignette(&quot;NeuroVector&quot;)</code> - Working with 4D neuroimaging
data</li>
<li><code>?read_vec</code> and <code>?read_vol</code> - Reading
neuroimaging files</li>
<li><code>?NeuroSpace</code> - Understanding coordinate systems and
spaces</li>
<li><code>?ClusteredNeuroVol</code> - Parcellation-based analyses</li>
<li><code>?SparseNeuroVol</code> - Memory-efficient sparse
representations</li>
<li><code>?series</code> and <code>?series_roi</code> - Time-series
extraction</li>
</ul>
<p>For the complete list of ROI-related functions:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="fu">help</span>(<span class="at">package =</span> <span class="st">&quot;neuroim2&quot;</span>, <span class="at">topic =</span> <span class="st">&quot;roi&quot;</span>)</span></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
