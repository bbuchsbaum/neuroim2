<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="neuroim2">
<title>Regions of Interest • neuroim2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Regions of Interest">
<meta property="og:description" content="neuroim2">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">neuroim2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/ImageVolumes.html">Working with Image Volumes</a>
    <a class="dropdown-item" href="../articles/NeuroVector.html">Four dimensional neuroimaging data</a>
    <a class="dropdown-item" href="../articles/neuroim.html">The neuroim2 package</a>
    <a class="dropdown-item" href="../articles/pipelines.html">Pipelines</a>
    <a class="dropdown-item" href="../articles/regionOfInterest.html">Regions of Interest</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/bbuchsbaum/neuroim2/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Regions of Interest</h1>
            
            <h4 data-toc-skip class="date">2023-04-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bbuchsbaum/neuroim2/blob/HEAD/vignettes/regionOfInterest.Rmd" class="external-link"><code>vignettes/regionOfInterest.Rmd</code></a></small>
      <div class="d-none name"><code>regionOfInterest.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="regions-of-interest">Regions of interest<a class="anchor" aria-label="anchor" href="#regions-of-interest"></a>
</h2>
<div class="section level3">
<h3 id="creating-a-spherical-roi">Creating a spherical ROI<a class="anchor" aria-label="anchor" href="#creating-a-spherical-roi"></a>
</h3>
<p>In <strong>neuroim2</strong> there is basic support for creating
regions of interest (ROI). To create a spherical ROI around a central
point, we need an existing object of type <code>NeuroVol</code> or
<code>NeuroSpace</code>.</p>
<p>To create a spherical region of interest with a 5mm radius around a
central voxel at i=20, j=20, k=20, we first read in an image.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>      <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bbuchsbaum/neuroim2" class="external-link">neuroim2</a></span><span class="op">)</span>        </span>
<span>      <span class="va">file_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"global_mask.nii"</span>, package<span class="op">=</span><span class="st">"neuroim2"</span><span class="op">)</span></span>
<span>      <span class="va">vol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_vol.html">read_vol</a></span><span class="op">(</span><span class="va">file_name</span><span class="op">)</span></span></code></pre></div>
<p>Next, we create a spherical ROI centered around voxel coordinates
[20,20,20] with a 5mm radius, filling all values in the ROI with
100.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>      <span class="va">sphere</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spherical_roi.html">spherical_roi</a></span><span class="op">(</span><span class="va">vol</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">20</span>,<span class="fl">20</span><span class="op">)</span>, radius<span class="op">=</span><span class="fl">5</span>, fill<span class="op">=</span><span class="fl">100</span>, use_cpp<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ROIVol </span></span>
<span><span class="co">#&gt;   Size:            11 </span></span>
<span><span class="co">#&gt;   Parent Dim:      64 64 25 </span></span>
<span><span class="co">#&gt;   Num Data Cols:   1 </span></span>
<span><span class="co">#&gt;   Voxel Cen. Mass: 20 20 20</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="creating-a-spherical-roi-around-a-real-valued-coordinate">Creating a Spherical ROI around a real-valued coordinate<a class="anchor" aria-label="anchor" href="#creating-a-spherical-roi-around-a-real-valued-coordinate"></a>
</h3>
<p>To create a spherical ROI centered around a real coordinate in
millimeters, we need to first convert the real-valued coordinates to a
voxel-based coordinate. Suppose our real-world coordinate is at -50,
-28, 10 in coordinate space.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span>    <span class="va">rpoint</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">34</span>,<span class="op">-</span><span class="fl">28</span>,<span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p>Because the function <code>spherical_roi</code> takes a coordinate in
<em>voxel units</em>, we need to convert the real-world coordinate
(i.e. in millimeter units) to voxel coordinates.</p>
<!-- ```{r} -->
<!--     vox <- coord_to_grid(vol, rpoint) -->
<!--     sphere <- spherical_roi(vol, vox, radius=10, fill=1) -->
<!--     dim(coords(sphere)) -->
<!-- ``` -->
<!-- Now we convert back to real-world coordinates -->
<!-- ```{r} -->
<!--     coords <- index_to_coord(vol, indices(sphere)) -->
<!--     center_of_mass <- colMeans(coords) -->
<!--     center_of_mass -->
<!-- ``` -->
<!-- ## Converting an ROI to a SparseNeuroVol -->
<!-- We may want to convert a region of interest to a NeuroVol instance. But we don't want to store every value in a dense array. Here we can make use of the `SparseNeuroVol` class which only stores non-zero values my using a `Matrix::sparseVector` under the hood. -->
<!-- ```{r} -->
<!--     sphere <- spherical_roi(vol, c(50,10,10), radius=10, fill=1) -->
<!--     sphere -->
<!-- ``` -->
<!-- Now we construct a `SparseNeuroVol` and fill it with the values stored in the ROI: -->
<!-- ```{r} -->
<!--     sparsevol <- SparseNeuroVol(sphere, space(vol),indices=indices(sphere)) -->
<!--     sum(sparsevol) == sum(sphere) -->
<!--     all(dim(sparsevol) == dim(vol)) -->
<!-- ``` -->
<!-- ## Carrying out simple "searchlight" ROI analyses -->
<!-- The so-called roving "searchlight" is often used to perform multivariate statistical analyses in a local neighborhood of each voxel of an image. Several functions in `neuroim2` can be used to carry out searchlight analyses. These functions produces `list`s of the `ROIVol` instances that encapsulate the local neighborhood around each voxel. -->
<!-- Here, we compute the mean value in an exhaustive set of spherical searchlights in an image volume. -->
<!-- ```{r} -->
<!-- library(purrr) -->
<!-- ## generate a list of searchlight ROIs -->
<!-- slist <- searchlight(vol, eager=TRUE, radius=8) -->
<!-- ## compute the mean value in each searchlight ROI. -->
<!-- ret <- slist %>% purrr::map(~ mean(vol[coords(.)])) -->
<!-- ``` -->
<!-- We can also use a "randomized searchlight", which samples voxels without replacement until all voxels have been included in at least one searchlight.  -->
<!-- ```{r} -->
<!-- ret <- vol %>% random_searchlight(radius=8) %>% purrr::map(~ mean(vol[coords(.)])) -->
<!-- ``` -->
<!-- Another related method involves using a "parcellation" or clustering to define successive regions of interest for an analysis. Here we show how to do this in a similar way as above. First we must define a 'clustering' over the voxel space: -->
<!-- ```{r} -->
<!-- grid <- index_to_coord(vol, which(vol > 0)) -->
<!-- kres <- kmeans(grid, centers=50, iter.max=500) -->
<!-- ``` -->
<!-- Now we create a `ClusteredNeuroVol` and map the `mean` function over all clusters: -->
<!-- ```{r} -->
<!-- kvol <- ClusteredNeuroVol(vol, kres$cluster) -->
<!-- ret <- vol %>% clustered_searchlight(cvol=kvol) %>% purrr::map(~ mean(vol[coords(.)])) -->
<!-- ``` -->
<!-- ## Working with image patches -->
<!-- Another type of ROI analysis, similar to the 'searchlight', involves working with sets of square or cuboid image "patches". The `patch_set` function can be used to generate a set of equally-sized patches that span the image space (or some mask covering the space). The patches are guaranteed to be of equal size. This means that at edges, 'patches' will be padded out with the value at the image extremes. -->
<!-- Here we create a patch set consistting of 3 by 3 by 1 square patches that span the image. -->
<!-- ```{r} -->
<!-- pset <- patch_set(vol, dims=c(3,3,1)) -->
<!-- length(pset) -->
<!-- ret <- pset %>% purrr::map(~ mean(.)) -->
<!-- ``` -->
<!-- Now we limit patches so that the set of patch centers are within a mask. -->
<!-- ```{r} -->
<!-- pset <- patch_set(vol, dims=c(3,3,1), mask=as.logical(vol)) -->
<!-- length(pset) -->
<!-- ret <- pset %>% purrr::map(~ mean(.)) -->
<!-- ``` -->
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Bradley R Buchsbaum.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
