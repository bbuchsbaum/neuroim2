<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Overview: Getting Started with neuroim2 • neuroim2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Overview: Getting Started with neuroim2">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">neuroim2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bbuchsbaum/neuroim2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Overview: Getting Started with neuroim2</h1>
            
            <h4 data-toc-skip class="date">2025-09-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bbuchsbaum/neuroim2/blob/master/vignettes/Overview.Rmd" class="external-link"><code>vignettes/Overview.Rmd</code></a></small>
      <div class="d-none name"><code>Overview.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><strong>neuroim2</strong> is a comprehensive R package for
neuroimaging data analysis, providing efficient data structures and
methods for handling 3D brain volumes and 4D time-series data. Whether
you’re working with structural MRI, functional MRI, or other volumetric
brain imaging data, neuroim2 offers the tools you need.</p>
<div class="section level3">
<h3 id="key-features">Key Features<a class="anchor" aria-label="anchor" href="#key-features"></a>
</h3>
<ul>
<li>
<strong>Efficient Data Structures</strong>: Optimized
representations for both dense and sparse neuroimaging data</li>
<li>
<strong>Flexible I/O</strong>: Read and write common neuroimaging
formats (NIfTI, AFNI)</li>
<li>
<strong>ROI Analysis</strong>: Create and analyze regions of
interest with various shapes</li>
<li>
<strong>Searchlight Methods</strong>: Implement searchlight analyses
for pattern detection</li>
<li>
<strong>Memory Management</strong>: Handle large datasets with
file-backed and memory-mapped arrays</li>
<li>
<strong>Spatial Operations</strong>: Resample, reorient, filter, and
transform brain images</li>
<li>
<strong>Parcellation Support</strong>: Work with brain atlases and
parcellated data</li>
</ul>
</div>
<div class="section level3">
<h3 id="quick-start">Quick Start<a class="anchor" aria-label="anchor" href="#quick-start"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bbuchsbaum/neuroim2" class="external-link">neuroim2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load a 3D brain volume</span></span>
<span><span class="va">img</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_vol.html">read_vol</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"global_mask2.nii.gz"</span>, package <span class="op">=</span> <span class="st">"neuroim2"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Inspect the spatial properties</span></span>
<span><span class="fu"><a href="../reference/space-methods.html">space</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span>      <span class="co"># Complete spatial information</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #BBBBBB; background-color: #0000BB; font-weight: bold;"> NeuroSpace Object </span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  <span style="color: #BBBB00; font-weight: bold;">&gt;&gt; Dimensions</span> </span></span>
<span><span class="co">#&gt;   <span style="color: #555555;">Grid Size:</span> <span style="color: #00BB00;">64 x 64 x 25</span></span></span>
<span><span class="co">#&gt;   <span style="color: #555555;">Memory:</span>   <span style="color: #00BB00;">5.9 KB</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  <span style="color: #BBBB00; font-weight: bold;">&gt;&gt; Spatial Properties</span> </span></span>
<span><span class="co">#&gt;   <span style="color: #555555;">Spacing:</span>   <span style="color: #0000BB;">3.50 x 3.50 x 3.70</span> <span style="color: #555555;">mm</span></span></span>
<span><span class="co">#&gt;   <span style="color: #555555;">Origin:</span>    <span style="color: #0000BB;">112.00 x -108.50 x -46.25</span> <span style="color: #555555;">mm</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  <span style="color: #BBBB00; font-weight: bold;">&gt;&gt; Anatomical Orientation</span> </span></span>
<span><span class="co">#&gt;   X: <span style="color: #00BB00;">Right-to-Left</span>  |  Y: <span style="color: #00BB00;">Posterior-to-Anterior</span>  |  Z: <span style="color: #00BB00;">Inferior-to-Superior</span> </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  <span style="color: #BBBB00; font-weight: bold;">&gt;&gt; World Transformation</span> </span></span>
<span><span class="co">#&gt; <span style="color: #555555;">  Forward (Voxel to World):</span> </span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">    -3.500  -0.000  -0.000   112.000</span></span></span>
<span><span class="co"><span style="color: #0000BB;">#&gt;  0.000   3.500  -0.000  -108.500</span></span></span>
<span><span class="co"><span style="color: #0000BB;">#&gt; -0.000   0.000   3.700   -46.250</span></span></span>
<span><span class="co"><span style="color: #0000BB;">#&gt;  0.000   0.000   0.000     1.000</span> </span></span>
<span><span class="co">#&gt; <span style="color: #555555;">  Inverse (World to Voxel):</span> </span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">    -0.286  -0.000  -0.000  32.000</span></span></span>
<span><span class="co"><span style="color: #0000BB;">#&gt;  0.000   0.286   0.000  31.000</span></span></span>
<span><span class="co"><span style="color: #0000BB;">#&gt;  0.000   0.000   0.270  12.500</span></span></span>
<span><span class="co"><span style="color: #0000BB;">#&gt;  0.000   0.000   0.000   1.000</span> </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  <span style="color: #BBBB00; font-weight: bold;">&gt;&gt; Bounding Box</span> </span></span>
<span><span class="co">#&gt;   <span style="color: #555555;">Min Corner:</span> <span style="color: #00BB00;">-108.5, -108.5, -46.2</span> mm</span></span>
<span><span class="co">#&gt;   <span style="color: #555555;">Max Corner:</span> <span style="color: #00BB00;">112.0, 112.0, 42.6</span> mm</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #BBBBBB; background-color: #0000BB; font-weight: bold;">==================================================</span></span></span>
<span><span class="fu"><a href="../reference/dim-methods.html">dim</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span>        <span class="co"># Dimensions</span></span>
<span><span class="co">#&gt; [1] 64 64 25</span></span>
<span><span class="fu"><a href="../reference/spacing-methods.html">spacing</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span>    <span class="co"># Voxel sizes</span></span>
<span><span class="co">#&gt; [1] 3.5 3.5 3.7</span></span>
<span><span class="fu"><a href="../reference/origin-methods.html">origin</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span>     <span class="co"># Origin coordinates</span></span>
<span><span class="co">#&gt; [1]  112.00 -108.50  -46.25</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="core-data-structures">Core Data Structures<a class="anchor" aria-label="anchor" href="#core-data-structures"></a>
</h2>
<div class="section level3">
<h3 id="d-volumes-neurovol">3D Volumes: NeuroVol<a class="anchor" aria-label="anchor" href="#d-volumes-neurovol"></a>
</h3>
<p>The <code>NeuroVol</code> class represents 3D brain volumes
(structural images, masks, single time points):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a synthetic 3D volume</span></span>
<span><span class="va">dims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">64</span>, <span class="fl">64</span>, <span class="fl">40</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="va">dims</span><span class="op">)</span><span class="op">)</span>, <span class="va">dims</span><span class="op">)</span></span>
<span><span class="va">vol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/NeuroVol.html">NeuroVol</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="../reference/NeuroSpace.html">NeuroSpace</a></span><span class="op">(</span><span class="va">dims</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Basic operations</span></span>
<span><span class="va">vol_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">vol</span><span class="op">)</span></span>
<span><span class="va">vol_sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">vol</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Volume mean:"</span>, <span class="va">vol_mean</span>, <span class="st">"SD:"</span>, <span class="va">vol_sd</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Volume mean: -0.003293314 SD: 1.001015</span></span>
<span></span>
<span><span class="co"># Logical volumes for masks</span></span>
<span><span class="va">mask</span> <span class="op">&lt;-</span> <span class="va">vol</span> <span class="op">&gt;</span> <span class="fl">0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Voxels above zero:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">mask</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Voxels above zero: 81574</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="d-time-series-neurovec">4D Time-Series: NeuroVec<a class="anchor" aria-label="anchor" href="#d-time-series-neurovec"></a>
</h3>
<p>The <code>NeuroVec</code> class handles 4D data (e.g., fMRI
time-series):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a 4D time-series (small example)</span></span>
<span><span class="va">dims_4d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">20</span><span class="op">)</span>  <span class="co"># 10x10x10 volume, 20 time points</span></span>
<span><span class="va">dat_4d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="va">dims_4d</span><span class="op">)</span><span class="op">)</span>, <span class="va">dims_4d</span><span class="op">)</span></span>
<span><span class="va">vec_4d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/NeuroVec-class.html">NeuroVec</a></span><span class="op">(</span><span class="va">dat_4d</span>, <span class="fu"><a href="../reference/NeuroSpace.html">NeuroSpace</a></span><span class="op">(</span><span class="va">dims_4d</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract time-series at a specific voxel</span></span>
<span><span class="va">ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/series-methods.html">series</a></span><span class="op">(</span><span class="va">vec_4d</span>, <span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Time-series length at voxel (5,5,5):"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ts</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Time-series length at voxel (5,5,5): 20</span></span>
<span></span>
<span><span class="co"># Extract a single volume at time point 10</span></span>
<span><span class="va">vol_t10</span> <span class="op">&lt;-</span> <span class="va">vec_4d</span><span class="op">[</span>,,,<span class="fl">10</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Volume at t=10 dimensions:"</span>, <span class="fu"><a href="../reference/dim-methods.html">dim</a></span><span class="op">(</span><span class="va">vol_t10</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Volume at t=10 dimensions: 10 10 10</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="region-of-interest-roi-analysis">Region of Interest (ROI) Analysis<a class="anchor" aria-label="anchor" href="#region-of-interest-roi-analysis"></a>
</h2>
<div class="section level3">
<h3 id="creating-rois">Creating ROIs<a class="anchor" aria-label="anchor" href="#creating-rois"></a>
</h3>
<p>neuroim2 provides multiple ways to define regions of interest:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Spherical ROI - most common for searchlight analyses</span></span>
<span><span class="va">sphere</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spherical_roi.html">spherical_roi</a></span><span class="op">(</span><span class="va">img</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">30</span>, <span class="fl">20</span><span class="op">)</span>, radius <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Spherical ROI contains"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sphere</span><span class="op">)</span>, <span class="st">"voxels\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Spherical ROI contains 11 voxels</span></span>
<span></span>
<span><span class="co"># Cuboid ROI - rectangular box</span></span>
<span><span class="va">cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cuboid_roi.html">cuboid_roi</a></span><span class="op">(</span><span class="fu"><a href="../reference/space-methods.html">space</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">30</span>, <span class="fl">20</span><span class="op">)</span>, surround <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Cuboid ROI contains"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cube</span><span class="op">)</span>, <span class="st">"voxels\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Cuboid ROI contains 343 voxels</span></span>
<span></span>
<span><span class="co"># Extract values from the original image using ROI</span></span>
<span><span class="va">roi_values</span> <span class="op">&lt;-</span> <span class="va">img</span><span class="op">[</span><span class="fu"><a href="../reference/coords.html">coords</a></span><span class="op">(</span><span class="va">sphere</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Mean value in spherical ROI:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">roi_values</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Mean value in spherical ROI: 1</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="searchlight-analysis">Searchlight Analysis<a class="anchor" aria-label="anchor" href="#searchlight-analysis"></a>
</h3>
<p>Searchlight is a powerful technique for local pattern analysis:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create searchlights with 6mm radius</span></span>
<span><span class="va">lights</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/searchlight.html">searchlight</a></span><span class="op">(</span><span class="va">img</span>, radius <span class="op">=</span> <span class="fl">6</span>, eager <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Process first few searchlights (normally you'd process all)</span></span>
<span><span class="va">first_5</span> <span class="op">&lt;-</span> <span class="va">lights</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="va">means</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">first_5</span>, <span class="kw">function</span><span class="op">(</span><span class="va">roi</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">img</span><span class="op">[</span><span class="fu"><a href="../reference/coords.html">coords</a></span><span class="op">(</span><span class="va">roi</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"First 5 searchlight means:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">means</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; First 5 searchlight means: 0.95 0.95 0.84 0.74 0.79</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="coordinate-systems-and-transformations">Coordinate Systems and Transformations<a class="anchor" aria-label="anchor" href="#coordinate-systems-and-transformations"></a>
</h2>
<div class="section level3">
<h3 id="coordinate-conversions">Coordinate Conversions<a class="anchor" aria-label="anchor" href="#coordinate-conversions"></a>
</h3>
<p>neuroim2 handles conversions between different coordinate
systems:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Voxel coordinates to world coordinates (mm)</span></span>
<span><span class="va">voxel_coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">30</span>, <span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">world_coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/grid_to_coord-methods.html">grid_to_coord</a></span><span class="op">(</span><span class="va">img</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">voxel_coords</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Voxel"</span>, <span class="va">voxel_coords</span>, <span class="st">"-&gt; World"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">world_coords</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"mm\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Voxel 30 30 20 -&gt; World 10.5 -7 24.05 mm</span></span>
<span></span>
<span><span class="co"># World coordinates back to voxel</span></span>
<span><span class="va">voxel_back</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/coord_to_grid-methods.html">coord_to_grid</a></span><span class="op">(</span><span class="va">img</span>, <span class="va">world_coords</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"World"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">world_coords</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"-&gt; Voxel"</span>, <span class="va">voxel_back</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; World 10.5 -7 24.05 -&gt; Voxel 30 30 19.99999</span></span>
<span></span>
<span><span class="co"># Linear indices</span></span>
<span><span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/grid_to_index-methods.html">grid_to_index</a></span><span class="op">(</span><span class="va">img</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">voxel_coords</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Voxel"</span>, <span class="va">voxel_coords</span>, <span class="st">"-&gt; Linear index"</span>, <span class="va">idx</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Voxel 30 30 20 -&gt; Linear index 79710</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="memory-efficient-operations">Memory-Efficient Operations<a class="anchor" aria-label="anchor" href="#memory-efficient-operations"></a>
</h2>
<div class="section level3">
<h3 id="sparse-representations">Sparse Representations<a class="anchor" aria-label="anchor" href="#sparse-representations"></a>
</h3>
<p>For data with many zero values (e.g., masks, ROIs):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a sparse representation directly from an ROI</span></span>
<span><span class="va">roi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spherical_roi.html">spherical_roi</a></span><span class="op">(</span><span class="va">img</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">30</span>, <span class="fl">20</span><span class="op">)</span>, radius <span class="op">=</span> <span class="fl">8</span>, fill <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert ROI to sparse volume</span></span>
<span><span class="va">sparse_roi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as.sparse.html">as.sparse</a></span><span class="op">(</span><span class="va">roi</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare memory usage (convert original ROI to dense for baseline)</span></span>
<span><span class="va">dense_vol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as.dense.html">as.dense</a></span><span class="op">(</span><span class="va">roi</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Dense size:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">dense_vol</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"auto"</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Dense size: 806.6 Kb</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Sparse size:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">sparse_roi</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"auto"</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Sparse size: 8.3 Kb</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Non-zero voxels:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">roi</span><span class="op">)</span>, <span class="st">"out of"</span>, <span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="fu"><a href="../reference/dim-methods.html">dim</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span><span class="op">)</span>, <span class="st">"total\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Non-zero voxels: 49 out of 102400 total</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Space savings:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">sparse_roi</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> </span>
<span>                              <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">dense_vol</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"%\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Space savings: 99 %</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="file-backed-arrays">File-Backed Arrays<a class="anchor" aria-label="anchor" href="#file-backed-arrays"></a>
</h3>
<p>For datasets too large to fit in memory:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a file-backed 4D dataset (not run in vignette)</span></span>
<span><span class="va">big_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FileBackedNeuroVec.html">FileBackedNeuroVec</a></span><span class="op">(</span></span>
<span>  dims <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">91</span>, <span class="fl">109</span>, <span class="fl">91</span>, <span class="fl">1000</span><span class="op">)</span>,  <span class="co"># Standard MNI space, 1000 volumes</span></span>
<span>  dtype <span class="op">=</span> <span class="st">"float32"</span>,</span>
<span>  file_name <span class="op">=</span> <span class="st">"big_data.dat"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Access works like regular arrays but data stays on disk</span></span>
<span><span class="va">subset</span> <span class="op">&lt;-</span> <span class="va">big_vec</span><span class="op">[</span><span class="fl">45</span>, <span class="fl">55</span>, <span class="fl">45</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>  <span class="co"># Load only what you need</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="spatial-filtering-and-processing">Spatial Filtering and Processing<a class="anchor" aria-label="anchor" href="#spatial-filtering-and-processing"></a>
</h2>
<div class="section level3">
<h3 id="smoothing-operations">Smoothing Operations<a class="anchor" aria-label="anchor" href="#smoothing-operations"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Gaussian smoothing with single sigma value (pass mask explicitly)</span></span>
<span><span class="va">img_smooth</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gaussian_blur.html">gaussian_blur</a></span><span class="op">(</span><span class="va">img</span>, <span class="va">img</span>, sigma <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare original vs smoothed</span></span>
<span><span class="va">orig_vals</span> <span class="op">&lt;-</span> <span class="va">img</span><span class="op">[</span><span class="fl">30</span><span class="op">:</span><span class="fl">32</span>, <span class="fl">30</span><span class="op">:</span><span class="fl">32</span>, <span class="fl">20</span><span class="op">]</span></span>
<span><span class="va">smooth_vals</span> <span class="op">&lt;-</span> <span class="va">img_smooth</span><span class="op">[</span><span class="fl">30</span><span class="op">:</span><span class="fl">32</span>, <span class="fl">30</span><span class="op">:</span><span class="fl">32</span>, <span class="fl">20</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Original variance:"</span>, <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">orig_vals</span><span class="op">)</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Original variance: 0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Smoothed variance:"</span>, <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">smooth_vals</span><span class="op">)</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Smoothed variance: 0</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="resampling">Resampling<a class="anchor" aria-label="anchor" href="#resampling"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Downsample by factor of 2</span></span>
<span><span class="va">img_down</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/downsample-methods.html">downsample</a></span><span class="op">(</span><span class="va">img</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Original dimensions:"</span>, <span class="fu"><a href="../reference/dim-methods.html">dim</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Original dimensions: 64 64 25</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Downsampled dimensions:"</span>, <span class="fu"><a href="../reference/dim-methods.html">dim</a></span><span class="op">(</span><span class="va">img_down</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Downsampled dimensions: 112 112 46</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="working-with-parcellations">Working with Parcellations<a class="anchor" aria-label="anchor" href="#working-with-parcellations"></a>
</h2>
<div class="section level3">
<h3 id="clusteredneurovol-for-atlas-based-analysis">ClusteredNeuroVol for Atlas-Based Analysis<a class="anchor" aria-label="anchor" href="#clusteredneurovol-for-atlas-based-analysis"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a simple parcellation</span></span>
<span><span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/index_to_coord-methods.html">index_to_coord</a></span><span class="op">(</span><span class="va">img</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="../reference/as.logical-methods.html">as.logical</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">10</span>  <span class="co"># 10 parcels</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">coords</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">km</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html" class="external-link">kmeans</a></span><span class="op">(</span><span class="va">coords</span>, centers <span class="op">=</span> <span class="va">k</span>, iter.max <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Create clustered volume</span></span>
<span>  <span class="va">cvol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ClusteredNeuroVol-class.html">ClusteredNeuroVol</a></span><span class="op">(</span><span class="va">img</span>, <span class="va">km</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Created"</span>, <span class="fu"><a href="../reference/num_clusters-methods.html">num_clusters</a></span><span class="op">(</span><span class="va">cvol</span><span class="op">)</span>, <span class="st">"parcels\n"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Get centroids of each parcel</span></span>
<span>  <span class="va">centers</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/centroids-methods.html">centroids</a></span><span class="op">(</span><span class="va">cvol</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"First parcel centroid:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">centers</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"mm\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Created 10 parcels</span></span>
<span><span class="co">#&gt; First parcel centroid: 41.3 26.2 18.8 mm</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="inputoutput-operations">Input/Output Operations<a class="anchor" aria-label="anchor" href="#inputoutput-operations"></a>
</h2>
<div class="section level3">
<h3 id="reading-and-writing">Reading and Writing<a class="anchor" aria-label="anchor" href="#reading-and-writing"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Write a volume to a temporary file</span></span>
<span><span class="va">tmp_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".nii.gz"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/write_vol-methods.html">write_vol</a></span><span class="op">(</span><span class="va">img</span>, <span class="va">tmp_file</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Wrote volume to:"</span>, <span class="va">tmp_file</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Wrote volume to: /tmp/RtmpZ6xM1V/file2a9a475e0b39.nii.gz</span></span>
<span></span>
<span><span class="co"># Read it back</span></span>
<span><span class="va">img_read</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_vol.html">read_vol</a></span><span class="op">(</span><span class="va">tmp_file</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Read volume with dimensions:"</span>, <span class="fu"><a href="../reference/dim-methods.html">dim</a></span><span class="op">(</span><span class="va">img_read</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Read volume with dimensions: 64 64 25</span></span>
<span></span>
<span><span class="co"># Clean up</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.remove</a></span><span class="op">(</span><span class="va">tmp_file</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="working-with-multiple-files">Working with Multiple Files<a class="anchor" aria-label="anchor" href="#working-with-multiple-files"></a>
</h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read multiple volumes (not run)</span></span>
<span><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"scan1.nii"</span>, <span class="st">"scan2.nii"</span>, <span class="st">"scan3.nii"</span><span class="op">)</span></span>
<span><span class="va">vols</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_vec.html">read_vec</a></span><span class="op">(</span><span class="va">files</span><span class="op">)</span>  <span class="co"># Creates a NeuroVecSeq</span></span>
<span></span>
<span><span class="co"># Or read as a single concatenated 4D volume</span></span>
<span><span class="va">vols_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">files</span>, <span class="va">read_vol</span><span class="op">)</span></span>
<span><span class="va">vec_concat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vec_from_vols.html">vec_from_vols</a></span><span class="op">(</span><span class="va">vols_list</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="practical-example-roi-based-time-series-analysis">Practical Example: ROI-Based Time-Series Analysis<a class="anchor" aria-label="anchor" href="#practical-example-roi-based-time-series-analysis"></a>
</h2>
<p>Here’s a complete workflow combining multiple features:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create synthetic fMRI-like data</span></span>
<span><span class="va">dims_fmri</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">20</span>, <span class="fl">15</span>, <span class="fl">50</span><span class="op">)</span>  <span class="co"># Small for example</span></span>
<span><span class="va">fmri_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="va">dims_fmri</span><span class="op">)</span>, mean <span class="op">=</span> <span class="fl">1000</span>, sd <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>, <span class="va">dims_fmri</span><span class="op">)</span></span>
<span><span class="va">fmri</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/NeuroVec-class.html">NeuroVec</a></span><span class="op">(</span><span class="va">fmri_data</span>, <span class="fu"><a href="../reference/NeuroSpace.html">NeuroSpace</a></span><span class="op">(</span><span class="va">dims_fmri</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define an ROI</span></span>
<span><span class="va">roi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spherical_roi.html">spherical_roi</a></span><span class="op">(</span><span class="fu"><a href="../reference/space-methods.html">space</a></span><span class="op">(</span><span class="va">fmri</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">8</span><span class="op">)</span>, radius <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"ROI size:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">roi</span><span class="op">)</span>, <span class="st">"voxels\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ROI size: 123 voxels</span></span>
<span></span>
<span><span class="co"># Extract time-series from ROI</span></span>
<span><span class="va">roi_ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/series_roi.html">series_roi</a></span><span class="op">(</span><span class="va">fmri</span>, <span class="va">roi</span><span class="op">)</span></span>
<span><span class="va">roi_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/values-methods.html">values</a></span><span class="op">(</span><span class="va">roi_ts</span><span class="op">)</span>  <span class="co"># T x N matrix</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"ROI time-series matrix:"</span>, <span class="fu"><a href="../reference/dim-methods.html">dim</a></span><span class="op">(</span><span class="va">roi_mat</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ROI time-series matrix: 50 123</span></span>
<span></span>
<span><span class="co"># Compute mean time-series</span></span>
<span><span class="va">mean_ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums-methods.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">roi_mat</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Z-score the mean time-series</span></span>
<span><span class="va">z_ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">mean_ts</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Mean time-series - Mean:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">z_ts</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>, </span>
<span>    <span class="st">"SD:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">z_ts</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Mean time-series - Mean: 0 SD: 1</span></span>
<span></span>
<span><span class="co"># Find peak activation time</span></span>
<span><span class="va">peak_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">z_ts</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Peak activation at time point:"</span>, <span class="va">peak_time</span>, </span>
<span>    <span class="st">"with z-score:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">z_ts</span><span class="op">[</span><span class="va">peak_time</span><span class="op">]</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Peak activation at time point: 41 with z-score: 2.16</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="performance-tips">Performance Tips<a class="anchor" aria-label="anchor" href="#performance-tips"></a>
</h2>
<ol style="list-style-type: decimal">
<li>
<strong>Use appropriate data structures</strong>:
<ul>
<li>
<code>SparseNeuroVol</code> for masks and ROIs</li>
<li>
<code>FileBackedNeuroVec</code> for very large datasets</li>
<li>Regular arrays for small-to-medium data</li>
</ul>
</li>
<li>
<strong>Vectorize operations</strong>:
<ul>
<li>Use <code><a href="../reference/spherical_roi_set.html">spherical_roi_set()</a></code> instead of loops for multiple
ROIs</li>
<li>Process searchlights in parallel when possible</li>
</ul>
</li>
<li>
<strong>Preallocate memory</strong>:
<ul>
<li>Know your output dimensions and allocate arrays upfront</li>
</ul>
</li>
<li>
<strong>Choose the right format</strong>:
<ul>
<li>Use compressed NIfTI (.nii.gz) for storage</li>
<li>Keep working data uncompressed for speed</li>
</ul>
</li>
</ol>
</div>
<div class="section level2">
<h2 id="getting-help">Getting Help<a class="anchor" aria-label="anchor" href="#getting-help"></a>
</h2>
<div class="section level3">
<h3 id="package-documentation">Package Documentation<a class="anchor" aria-label="anchor" href="#package-documentation"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># List all functions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/help.html" class="external-link">help</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"neuroim2"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Search for specific topics</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/help.search.html" class="external-link">help.search</a></span><span class="op">(</span><span class="st">"roi"</span>, package <span class="op">=</span> <span class="st">"neuroim2"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="vignettes-for-deep-dives">Vignettes for Deep Dives<a class="anchor" aria-label="anchor" href="#vignettes-for-deep-dives"></a>
</h3>
<ul>
<li>
<strong>3D Volumes</strong>:
<code><a href="../articles/ImageVolumes.html">vignette("ImageVolumes", package = "neuroim2")</a></code>
</li>
<li>
<strong>4D Time-Series</strong>:
<code><a href="../articles/NeuroVector.html">vignette("NeuroVector", package = "neuroim2")</a></code><br>
</li>
<li>
<strong>ROI Analysis</strong>:
<code><a href="../articles/regionOfInterest.html">vignette("regionOfInterest", package = "neuroim2")</a></code>
</li>
<li>
<strong>Parcellations</strong>:
<code><a href="../articles/clustered-neurovec.html">vignette("clustered-neurovec", package = "neuroim2")</a></code>
</li>
<li>
<strong>Pipelines</strong>:
<code><a href="../articles/pipelines.html">vignette("pipelines", package = "neuroim2")</a></code>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="quick-reference">Quick Reference<a class="anchor" aria-label="anchor" href="#quick-reference"></a>
</h3>
<p>Common operations at a glance:</p>
<table class="table">
<thead><tr class="header">
<th>Task</th>
<th>Function</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Read NIfTI file</td>
<td>
<code><a href="../reference/read_vol.html">read_vol()</a></code>, <code><a href="../reference/read_vec.html">read_vec()</a></code>
</td>
</tr>
<tr class="even">
<td>Write NIfTI file</td>
<td>
<code><a href="../reference/write_vol-methods.html">write_vol()</a></code>, <code><a href="../reference/write_vec-methods.html">write_vec()</a></code>
</td>
</tr>
<tr class="odd">
<td>Create spherical ROI</td>
<td><code><a href="../reference/spherical_roi.html">spherical_roi()</a></code></td>
</tr>
<tr class="even">
<td>Extract time-series</td>
<td>
<code><a href="../reference/series-methods.html">series()</a></code>, <code><a href="../reference/series_roi.html">series_roi()</a></code>
</td>
</tr>
<tr class="odd">
<td>Smooth image</td>
<td><code><a href="../reference/gaussian_blur.html">gaussian_blur()</a></code></td>
</tr>
<tr class="even">
<td>Resample image</td>
<td><code><a href="../reference/resample-methods.html">resample()</a></code></td>
</tr>
<tr class="odd">
<td>Coordinate conversion</td>
<td>
<code><a href="../reference/coord_to_grid-methods.html">coord_to_grid()</a></code>, <code><a href="../reference/grid_to_coord-methods.html">grid_to_coord()</a></code>
</td>
</tr>
<tr class="even">
<td>Create mask</td>
<td><code><a href="../reference/LogicalNeuroVol-class.html">LogicalNeuroVol()</a></code></td>
</tr>
<tr class="odd">
<td>Sparse representation</td>
<td><code><a href="../reference/as.sparse.html">as.sparse()</a></code></td>
</tr>
<tr class="even">
<td>Concatenate volumes</td>
<td><code><a href="../reference/concat-methods.html">concat()</a></code></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>neuroim2 provides a comprehensive toolkit for neuroimaging analysis
in R. Its efficient data structures, flexible ROI tools, and
memory-conscious design make it suitable for both interactive
exploration and large-scale processing pipelines. Start with the basic
NeuroVol and NeuroVec classes, explore ROI creation for your specific
needs, and leverage sparse or file-backed arrays when working with large
datasets.</p>
<p>For more advanced usage and specific workflows, consult the
topic-specific vignettes listed above.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bradley R Buchsbaum.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
